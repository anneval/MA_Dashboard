---
title: "trendEcon AT"
output: 
  flexdashboard::flex_dashboard:
    theme: journal #  yeti
      #bg: "#101010"
      #fg: "#FDF7F7" 
      #primary: "#ED79F9"
      #base_font: !expr bslib::font_google("Prompt")
      #code_font: !expr bslib::font_google("JetBrains Mono")
    orientation: rows
    version: 4
    #source_code: embed
    vertical_layout: scroll
    social: ["menu"]
    navbar:
      - {icon: "fa-github", 
         title: "Data", 
         href: "https://github.com/anneval/MA", align: right, target: blank}
      - {title: "R package", href: "https://trendecon.github.io/trendecon/", align: right, target: blank}
  
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tsbox)
library(dygraphs)
library(readr)
library(dplyr)
library(tidyr)
library(knitr)
library(ggplot2)
library(readxl)
```


```{r, include=FALSE}
today <- as.character(Sys.Date())

getMonth <- 'function(d){
               var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun","Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
               return monthNames[d.getMonth()];
               }'
#the x values are passed as milliseconds, turn them into a date and extract month and day
getMonthDay <- 'function(d) {
                var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun","Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                date = new Date(d);
                return monthNames[date.getMonth()] + " " +date.getDate(); }'
```

# Economic Indices
### trendEcon Austria

This dashboard provides daily (economic) sentiment indicators based on Google searches in Austria. The data for the Google searches is scraped from Google Trends using the `trendecon` R-package. The project builds upon the work of [trendEcon](https://www.trendecon.org). Next to the presentation of the daily sentiment indices the goal is to evaluate the main indicator's (daily  economic sentiment index)  nowcasting performance and accuracy in an GDP psequdo out of sample forecasting exercise. To analyze the indicators performance several models (VAR,ARIMA,OLS) are being compared. 
 
## Row {.tabset .tabset-fade}

### Daily Economic Sentiment Indices
```{r}
keywords <- c("Wirtschaftskrise", "Kurzarbeit", "arbeitslos", "Insolvenz","Inflation") #
Google_AT_daily <- read.csv("https://raw.githubusercontent.com/anneval/MA_data/main/raw/at/trendecon_sa.csv")

economic_sentiment <- Google_AT_daily %>%
  dplyr::select(time,value) %>%
  ts_xts()

events <- read.csv2("https://raw.githubusercontent.com/anneval/MA_Dashboard/main/docs/Events.csv")
events$date <- as.Date(events$date)

dygraph(economic_sentiment,group = "keywords")%>%
  dyAxis("x", drawGrid = FALSE)%>%
  dySeries("value", label = "Index")%>%
  dyEvent(events$date, events$event, labelLoc = "bottom") %>%
  dyRangeSelector(dateWindow = c("2006-01-01", today))%>%
  dyOptions(useDataTimezone = TRUE)
```
### Monthly

```{r}
data_monthly <- economic_sentiment %>%
  ts_frequency("month")
ts_dygraphs(ts_c(
  `Perceived Economic Situation` = data_monthly
)) %>%
  dyRangeSelector()
```

### Info

###### Description

The indicator for the *Perceived Economic Situation* includes search terms that reflect people’s worries about the economy. For instance, people might google “economic crisis” (Wirtschaftskrise) to get information.

###### Keywords

- Wirtschaftskrise
- Kurzarbeit
- arbeitslos
- Insolvenz

## Row {.tabset .tabset-fade}

### Daily Consumption Sentiment Indices
```{r}
keywords <- c("Shopping", "Klamotten", "Autokauf", "Restaurant", "Möbel")
Consumption_AT_daily <- read.csv("https://raw.githubusercontent.com/anneval/MA_data/main/raw/at/consumption_sa.csv")

consumption_sentiment <- Consumption_AT_daily %>%
  dplyr::select(time,value) %>%
  ts_xts()

dygraph(consumption_sentiment,group = "keywords")%>%
  dyAxis("x", drawGrid = FALSE)%>%
  dySeries("value", label = "Index")%>%
      dyRangeSelector(dateWindow = c("2006-01-01", today))%>%
    #  dyEvent(events$date, events$event, labelLoc = "bottom") %>%
      dyOptions(useDataTimezone = TRUE)
```
### Monthly

```{r}
data_monthly <- consumption_sentiment %>%
  ts_frequency("month")
ts_dygraphs(ts_c(
  `Perceived Consumption Situation` = data_monthly
)) %>%
  dyRangeSelector()
```
### Info

###### Description

The indicator for the *Perceived Consumption Situation* includes search terms that reflect people’s consumption behavior and thus gives indications for the current economic situations.

###### Keywords

- Shopping
- Klamotten
- Autokauf
- Restaurant
- Möbel

## Row {.tabset .tabset-fade}

### Daily Unemployement Sentiment Indices
```{r}
keywords <- c("Jobagentur", "Arbeitslosengeld", "Jobcenter", "arbeitslos")
Unemployment_AT_daily <- read.csv("https://raw.githubusercontent.com/anneval/MA_data/main/raw/at/unemployment_sa.csv")

unemployment_sentiment <- Unemployment_AT_daily %>%
 dplyr::select(time,value) %>%
  ts_xts()

dygraph(unemployment_sentiment,group = "keywords")%>%
  dyAxis("x", drawGrid = FALSE)%>%
  dySeries("value", label = "Index")%>%
      dyRangeSelector(dateWindow = c("2006-01-01", today))%>%
     # dyEvent(events$date, events$event, labelLoc = "bottom") %>%
      dyOptions(useDataTimezone = TRUE)
```
### Monthly

```{r}
data_monthly <- unemployment_sentiment %>%
  ts_frequency("month")
ts_dygraphs(ts_c(
  `Perceived Unemployment Situation` = data_monthly
)) %>%
  dyRangeSelector()
```

### Info

###### Description

The indicator for the *Perceived Unemployment Situation* includes search terms that reflect people’s search behavior regarding their current job situation and thus gives indications for the current unemployment situations.

###### Keywords

- Arbeitslosengeld
- Jobcenter
- arbeitslos

## Row {.tabset .tabset-fade}

### Daily Housing Sentiment Indices
```{r}
keywords <- c("Immobilienfinanzierung", "immobilienscout24", "Immobilien","Makler")
Housing_AT_daily <- read.csv("https://raw.githubusercontent.com/anneval/MA_data/main/raw/at/housing_sa.csv")

housing_sentiment <- Housing_AT_daily %>%
  dplyr::select(time,value) %>%
  ts_xts()

dygraph(housing_sentiment,group = "keywords")%>%
  dyAxis("x", drawGrid = FALSE)%>%
  dySeries("value", label = "Index")%>%
      dyRangeSelector(dateWindow = c("2006-01-01", today))%>%
     # dyEvent(events$date, events$event, labelLoc = "bottom") %>%
      dyOptions(useDataTimezone = TRUE)
```
### Monthly

```{r}
data_monthly <- housing_sentiment %>%
  ts_frequency("month")
ts_dygraphs(ts_c(
  `Perceived Housing Situation` = data_monthly
)) %>%
  dyRangeSelector()
```

### Info

###### Description

The indicator for the *Perceived Housing Situation* includes search terms that reflect people’s search behavior regarding their current job situation and thus gives indications for the current unemployment situations.

###### Keywords

- Immobilienfinanzierung
- immobilienscout24
- Immobilien
- Makler

## Row

# Corona Index 
#### **Corona Indicator**
### {style="border: 0px; background: none"}

For some indicators, such as *Cultural Events* -- which includes demand for restaurants, cinemas, concerts etc. -- or *Gardening and Home Improvement* (aka do-it-yourself articles), there is no preexisting, well-established indicator to compare our search-based indicators with. Nevertheless these indicators appear meaningful, as we are observing substantial changes in searches for these goods and services compared to normal times. These indicators will therefore provide valuable information on whether the economy is going back to normal as lock-down measures are lifted. In the beginning, some people, especially people in risk groups, may still be be reluctant to go, for example, to restaurants or stroll around shopping malls because they are afraid of contracting the virus.


## Row {.tabset .tabset-fade}
### Daily Corona Sentiment Indices
```{r}
keywords <- c("Inzidenz", "Coronafälle", "Testcenter", "Lockdown", "Pandemie")#
Corona_AT_daily <- read.csv("https://raw.githubusercontent.com/anneval/MA_data/main/raw/at/corona_sa.csv", skip=2192,header = FALSE, col.names = c("time", "value"))

corona_sentiment <- Corona_AT_daily[] %>%
  dplyr::select(time,value) %>%
  ts_xts()

dygraph(corona_sentiment,group = "keywords")%>%
  dyAxis("x", drawGrid = FALSE)%>%
  dySeries("value", label = "Index")%>%
      dyRangeSelector(dateWindow = c("2020-01-01", today))%>%
      dyEvent(events$date, events$event, labelLoc = "bottom") %>%
      dyOptions(useDataTimezone = TRUE)
```
### Monthly

```{r}
data_monthly <- corona_sentiment %>%
  ts_frequency("month")
ts_dygraphs(ts_c(
  `Perceived Corona Situation` = data_monthly
)) %>%
  dyRangeSelector()
```

### Info

###### Description

The indicator for the *Perceived Corona Situation* includes search terms that reflect people’s worries about the current corona situations. For instance, people might google “incidence” (Inzidenz), to get information.

###### Keywords

- Inzidenz
- Coronafälle
- Testcenter
- Lockdown
- Pandemie

# Weekly Indices
#### **Weekly Indicators**
### {style="border: 0px; background: none"}

For some indicators, such as *Cultural Events* -- which includes demand for restaurants, cinemas, concerts etc. -- or *Gardening and Home Improvement* (aka do-it-yourself articles), there is no preexisting, well-established indicator to compare our search-based indicators with. Nevertheless these indicators appear meaningful, as we are observing substantial changes in searches for these goods and services compared to normal times. These indicators will therefore provide valuable information on whether the economy is going back to normal as lock-down measures are lifted. In the beginning, some people, especially people in risk groups, may still be be reluctant to go, for example, to restaurants or stroll around shopping malls because they are afraid of contracting the virus.

```{r,echo = FALSE}
### Change from daily to weekly frequency
google <- Google_AT_daily[,1:2]
library(tsbox)
google_w <- ts_frequency(google, to = "week") %>% ts_xts()

#### OECD weekly tracker
temp <- tempfile()
download.file("https://github.com/NicolasWoloszko/OECD-Weekly-Tracker/raw/main/Data/weekly_tracker.xlsx",
              destfile = temp)

oecd <- read_xlsx(temp, sheet = "Sheet1") %>%
  #oecd <- read_xlsx("./real_data/weekly_tracker.xlsx", sheet = "Sheet1") %>%
  filter(region == "Austria") %>%
  #filter(region %in% c("Austria", "Germany", "Switzerland")) %>%
  mutate(date = as.Date(date),
         Tracker = `Tracker (yoy)` / 100) %>%
  filter(date >= "2020-01-01") %>%
  rename(time = date, value = Tracker) %>%
  dplyr::select(time, value) %>%
  ts_xts()

### OENB Weekly Tracker

temp <- tempfile()
download.file("https://www.oenb.at/dam/jcr:7c5ab44b-204d-4d45-a802-884d1019f7f5/data_on_the_weekly_GDP-indicator.csv",
              destfile = temp)

#### first weeks fehlt
wecon_oenb <- read_delim(temp, delim = ";", escape_double = FALSE, trim_ws = TRUE) %>%
  drop_na(Calenderweek) %>%
  rename(time = Calenderweek, value = `Real GDP compared to pre-crisis levels`) %>%
  dplyr::select(time, value)

wecon_oenb <- ts(wecon_oenb, start = c(2020,10), frequency = 52) %>% ts_xts()


library(lubridate)
wecon_oenb_test <- ts(wecon_oenb, 
   freq=365.25/7, 
   start=decimal_date(ymd("2020-03-06"))) %>% ts_xts()

wecon_oenb_test <- wecon_oenb_test %>% xts:::.drop.time()

### WIFO Weekly Tracker 
temp <- tempfile()
download.file("https://www.wifo.ac.at/wwadocs/konjunktur/W%C3%B6chentlicherWIFOWirtschaftsindex/WIFO-Konjunkturberichterstattung_W%C3%B6chentlicherWIFOWirtschaftsindex.xlsx",
              destfile = temp)

t0 <- as.numeric(as.Date("2007-01-01"))
t1 <- as.numeric(as.Date(Sys.Date()))
t <- round((t1 - t0) / 7) - 3 # weeks passed since index started

wwwi <- read_xlsx(temp, sheet = "WWWI",
                  #wwwi <- read_xlsx(path = "./real_data/wwwi_wifo.xlsx", sheet = "WWWI",
                  skip = 2, col_names = c("DATE", "VALUE", "cng_yavg", "cng_q"),
                  #col_types = c("date", "guess", "guess", "guess"), 
                  n_max = t) %>%
  mutate(DATE = as.character(DATE)) %>%
  dplyr::select(DATE, VALUE) %>%
  rename(time = DATE, value = VALUE) %>%
  ts_xts()
```


```{r,echo = FALSE}
google_w <- google_w[time(google_w) >= "2020-01-01"]  
wwwi <- wwwi[time(wwwi) >= "2020-01-01"]  
oecd <- oecd[time(oecd) >= "2020-01-01"]  

wecon_oenb <- wecon_oenb %>% xts:::.drop.time()
library(lubridate)
wwwi <- wwwi %>% ts_data.frame()
wwwi$time <- wwwi$time %m-% days(3)
wwwi <- wwwi %>% ts_xts()

oecd <- oecd %>% ts_data.frame()
oecd$time <- oecd$time %m-% days(2)
oecd <- oecd %>% ts_xts()

google_w <- google_w %>% ts_data.frame()
google_w$time <- google_w$time %m-% days(2)
google_w <- google_w %>% ts_xts()

wecon_oenb_test <- wecon_oenb_test %>% ts_data.frame()
wecon_oenb_test[1,1] <- as.Date("2020-03-06")
wecon_oenb_test <- wecon_oenb_test %>% ts_xts()
```

## Row {.tabset .tabset-fade}

### Comparison of different weekly indicators
```{r ce_background, echo = FALSE}

### {}

### Plot
library(dygraphs)
ts_dygraphs(ts_c(
  `Google DESI` = google_w * 5,
  `WIFO WWWI` = wwwi,
  `OECD Weekly Tracker` = oecd * 100,
  `OENB Weekly Indicator` = wecon_oenb_test
))  %>%
  dySeries("Google DESI", strokeWidth=2, color = "black") %>%
  dySeries("WIFO WWWI", strokeWidth = 2,  color = "red") %>%
  dySeries("OECD Weekly Tracker", strokeWidth = 2,  color = "green") %>%
  dySeries("OENB Weekly Indicator", strokeWidth = 2,  color = "steelblue") %>%
  dyAxis("x", drawGrid = FALSE) %>%
  dyRangeSelector()%>%
  #dyRangeSelector(dateWindow = c(as.Date("2020-01-01"), Sys.Date()))%>%
  dyOptions(useDataTimezone = TRUE)

```
### Monthly

```{r}
data_monthly <- ts_c(
  `Google DESI` = google_w * 5,
  `WIFO WWWI` = wwwi,
  `OECD Weekly Tracker` = oecd * 100,
  `OENB Weekly Indicator` = wecon_oenb_test
) %>%
  ts_frequency("month")
ts_dygraphs(ts_c(
  `Perceived Housing Situation` = data_monthly)) %>%
  dyRangeSelector()
```

### Info

###### Description

The indicator for the *Perceived Housing Situation* includes search terms that reflect people’s search behavior regarding their current job situation and thus gives indications for the current unemployment situations.

###### Keywords


# Forecasting

Expanding OLS

VAR

ARIMA






