---
title: "trendEcon AT"
output: 
  flexdashboard::flex_dashboard:
    theme: journal #  yeti
      #bg: "#101010"
      #fg: "#FDF7F7" 
      #primary: "#ED79F9"
      #base_font: !expr bslib::font_google("Prompt")
      #code_font: !expr bslib::font_google("JetBrains Mono")
    orientation: rows
    version: 4
    #source_code: embed
    vertical_layout: scroll
    social: ["menu"]
    navbar:
      - {icon: "fa-github", 
         title: "Data", 
         href: "https://github.com/anneval/MA", align: right, target: blank}
      - {title: "R package", href: "https://trendecon.github.io/trendecon/", align: right, target: blank}
  
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tsbox)
library(dygraphs)
library(readr)
library(dplyr)
library(tidyr)
library(knitr)
library(ggplot2)
library(readxl)
library()
```


```{r, include=FALSE}
today <- as.character(Sys.Date())

getMonth <- 'function(d){
               var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun","Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
               return monthNames[d.getMonth()];
               }'
#the x values are passed as milliseconds, turn them into a date and extract month and day
getMonthDay <- 'function(d) {
                var monthNames = ["Jan", "Feb", "Mar", "Apr", "May", "Jun","Jul", "Aug", "Sep", "Oct", "Nov", "Dec"];
                date = new Date(d);
                return monthNames[date.getMonth()] + " " +date.getDate(); }'
```

# Economic Indices
### trendEcon Austria

This dashboard provides daily (economic) sentiment indicators based on Google searches in Austria. The data for the Google searches is scraped from Google Trends using the `trendecon` R-package. The project builds upon the work of [trendEcon](https://www.trendecon.org). The construction of the daily sentiment indices is part of the Master thesis: "Nowcasting GDP growth in Austria via the construction of a daily
economic sentiment index using Google Trends". Next to the presentation of the daily sentiment indices the goal is to evaluate the main indicator's (daily economic sentiment index) nowcasting performance and accuracy in an GDP psequdo-out -of-sample forecasting exercise. To analyze the indicators performance several models (OLS,AR,VAR) are being compared.

## Row {.tabset .tabset-fade}

### Daily Economic Sentiment Index
```{r}
keywords <- c("Wirtschaftskrise", "Kurzarbeit", "arbeitslos", "Insolvenz","Inflation") #
Google_AT_daily <- read.csv("https://raw.githubusercontent.com/anneval/MA_data/main/raw/at/trendecon_sa.csv")

economic_sentiment <- Google_AT_daily %>%
  dplyr::select(time,value) %>%
  ts_xts()

events <- read.csv2("https://raw.githubusercontent.com/anneval/MA_Dashboard/main/docs/Events.csv")
events$date <- as.Date(events$date)

dygraph(economic_sentiment,group = "keywords")%>%
  dyAxis("x", drawGrid = FALSE)%>%
  dySeries("value", label = "Index")%>%
  dyEvent(events$date, events$event, labelLoc = "bottom") %>%
  dyRangeSelector(dateWindow = c("2006-01-01", today))%>%
  dyOptions(useDataTimezone = TRUE)
```
### Monthly

```{r}
data_monthly <- economic_sentiment %>%
  ts_frequency("month")
ts_dygraphs(ts_c(
  `Perceived Economic Situation` = data_monthly
)) %>%
  dyRangeSelector()
```

### Info

###### Description

The sentiment indicator for the *Perceived Economic Situation* consists of Goolge search terms that aim to reflect people’s concerns about the current economic situation. For instance, people might search for "Wirtschaftskrise" (= economic crisis) to get information.  

###### Keywords

- economic crisis ("Wirtschaftskrise")
- short-term work ("Kurzarbeit)
- unemployed ("arbeitslos")
- insolvency ("Insolvenz")

[Download data](https://raw.githubusercontent.com/anneval/MA_data/main/raw/at/trendecon_sa.csv){target="_blank"}

## Row {.tabset .tabset-fade}

### Daily Consumption Sentiment Index
```{r}
keywords <- c("Shopping", "Klamotten", "Autokauf", "Restaurant", "Möbel")
Consumption_AT_daily <- read.csv("https://raw.githubusercontent.com/anneval/MA_data/main/raw/at/consumption_sa.csv")

consumption_sentiment <- Consumption_AT_daily %>%
  dplyr::select(time,value) %>%
  ts_xts()

dygraph(consumption_sentiment,group = "keywords")%>%
  dyAxis("x", drawGrid = FALSE)%>%
  dySeries("value", label = "Index")%>%
      dyRangeSelector(dateWindow = c("2006-01-01", today))%>%
    #  dyEvent(events$date, events$event, labelLoc = "bottom") %>%
      dyOptions(useDataTimezone = TRUE)
```
### Monthly

```{r}
data_monthly <- consumption_sentiment %>%
  ts_frequency("month")
ts_dygraphs(ts_c(
  `Perceived Consumption Situation` = data_monthly
)) %>%
  dyRangeSelector()
```
### Info

###### Description

The sentiment indicator for the *Perceived Consumption Situation* consists of Goolge search terms that reflect people’s consumption behavior and thus gives indications for the current economic situations. For instance, people might search for "Restaurant" to get information.  

###### Keywords

- shopping
- clothing ("Klamotten")
- car sale ("Autokauf")
- restaurant
- furniture ("Möbel")

[Download data](https://github.com/anneval/MA_data/blob/main/raw/at/consumption_sa.csv){target="_blank"}

## Row {.tabset .tabset-fade}

### Daily Unemployement Sentiment Index
```{r}
keywords <- c("Jobagentur", "Arbeitslosengeld", "Jobcenter", "arbeitslos")
Unemployment_AT_daily <- read.csv("https://raw.githubusercontent.com/anneval/MA_data/main/raw/at/unemployment_sa.csv")

unemployment_sentiment <- Unemployment_AT_daily %>%
 dplyr::select(time,value) %>%
  ts_xts()

dygraph(unemployment_sentiment,group = "keywords")%>%
  dyAxis("x", drawGrid = FALSE)%>%
  dySeries("value", label = "Index")%>%
      dyRangeSelector(dateWindow = c("2006-01-01", today))%>%
     # dyEvent(events$date, events$event, labelLoc = "bottom") %>%
      dyOptions(useDataTimezone = TRUE)
```
### Monthly

```{r}
data_monthly <- unemployment_sentiment %>%
  ts_frequency("month")
ts_dygraphs(ts_c(
  `Perceived Unemployment Situation` = data_monthly
)) %>%
  dyRangeSelector()
```

### Info

###### Description

The indicator for the *Perceived Unemployment Situation* includes search terms that reflect people’s search behavior regarding their current job situation and thus gives indications for the current unemployment situations.

###### Keywords

- unemployment benefit ("Arbeitslosengeld")
- Jobcenter
- unemployed ("arbeitslos")

[Download data](https://github.com/anneval/MA_data/blob/main/raw/at/unemployment_sa.csv){target="_blank"}

## Row {.tabset .tabset-fade}

### Daily Housing Sentiment Index
```{r}
keywords <- c("Immobilienfinanzierung", "immobilienscout24", "Immobilien","Makler")
Housing_AT_daily <- read.csv("https://raw.githubusercontent.com/anneval/MA_data/main/raw/at/housing_sa.csv")

housing_sentiment <- Housing_AT_daily %>%
  dplyr::select(time,value) %>%
  ts_xts()

dygraph(housing_sentiment,group = "keywords")%>%
  dyAxis("x", drawGrid = FALSE)%>%
  dySeries("value", label = "Index")%>%
      dyRangeSelector(dateWindow = c("2006-01-01", today))%>%
     # dyEvent(events$date, events$event, labelLoc = "bottom") %>%
      dyOptions(useDataTimezone = TRUE)
```
### Monthly

```{r}
data_monthly <- housing_sentiment %>%
  ts_frequency("month")
ts_dygraphs(ts_c(
  `Perceived Housing Situation` = data_monthly
)) %>%
  dyRangeSelector()
```

### Info

###### Description

The indicator for the *Perceived Housing Situation* includes search terms that reflect people’s search behavior regarding their current interest in the housing market and its prices and thus gives indications for the current economic situations.

###### Keywords

- mortgaging ("Immobilienfinanzierung")
- immobilienscout24
- real estate ("Immobilien")
- real estate agent ("Makler")

[Download data](https://github.com/anneval/MA_data/blob/main/raw/at/housing_sa.csv){target="_blank"}

## Row

# Corona Index 
#### **Corona Indicator**
### {style="border: 0px; background: none"}

The following figure illustrates the *Daily Corona Sentiment Index*. The index includes searches for incidence, Covid cases, test center, lockdown and pandemic. There is no preexisting, well-established indicator to compare this search-based indicators with. Nevertheless it mirrors the public's perception on how good or bad the current Covid situation is developing. 

## Row {.tabset .tabset-fade}
### Daily Corona Sentiment Index
```{r}
keywords <- c("Inzidenz", "Coronafälle", "Testcenter", "Lockdown", "Pandemie")#
Corona_AT_daily <- read.csv("https://raw.githubusercontent.com/anneval/MA_data/main/raw/at/corona_sa.csv", skip=2192,header = FALSE, col.names = c("time", "value"))

corona_sentiment <- Corona_AT_daily[] %>%
  dplyr::select(time,value) %>%
  ts_xts()

dygraph(corona_sentiment,group = "keywords")%>%
  dyAxis("x", drawGrid = FALSE)%>%
  dySeries("value", label = "Index")%>%
      dyRangeSelector(dateWindow = c("2020-01-01", today))%>%
      dyEvent(events$date, events$event, labelLoc = "bottom") %>%
      dyOptions(useDataTimezone = TRUE)
```
### Monthly

```{r}
data_monthly <- corona_sentiment %>%
  ts_frequency("month")
ts_dygraphs(ts_c(
  `Perceived Corona Situation` = data_monthly
)) %>%
  dyRangeSelector()
```

### Info

###### Description

The indicator for the *Perceived Corona Situation* includes search terms that reflect people’s worries about the current corona situations. For instance, people might google "Inzidenz" (= incidence), to get information.

###### Keywords

- incidence ("Inzidenz")
- Covid cases ("Coronafälle")
- test center ("Testcenter")
- Lockdown
- pandemic ("Pandemie")

[Download data](https://github.com/anneval/MA_data/blob/main/raw/at/corona_sa.csv){target="_blank"}


# Weekly Indices
#### **Weekly Indicators**
### {style="border: 0px; background: none"}

The following figure compares the daily economic sentiment index to three other recently developed higher frequency GDP indicators - the weekly OeNB GDP indicator, the Weekly WIFO Economic Index (WWWI), and the OECD weekly tracker of GDP growth. To directly compare all four indicators, I temporally aggregate the DESI to the lower weekly frequency. The figure below plots the weekly indicators starting in January 2020. All four indicators capture the economic downturn at the end of the first quarter of 2020 due to the Covid19 outbreak. Compared to the other three indicators, the constructed Google based DESI can identify the decline of economic activity early on. Moreover, the DESI depicts a more profound downfall of the economy. Over the rest of 2020, the four indicators seem to co-move. Between the end of 2020 and the beginning of 2021, the WWWI and the OECD weekly tracker start to diverge from the DESI and the OEnB weekly tracker. In the middle of 2021, the indices slightly converge again, with the WWWI and the OECD weekly tracker remaining on higher levels. None of the indicators is able to properly capture the GDP rebound starting in the third quarter of 2020. Overall, the four indices follow a similar pattern and mostly show divergence in times of increased economic distress. This seems reasonable due to the depth of the different modeling approaches (e.g., linear or nonlinear) and the different data sources or data combinations used. 

```{r,echo = FALSE}
### Change from daily to weekly frequency
google <- Google_AT_daily[,1:2]
library(tsbox)
google_w <- ts_frequency(google, to = "week") %>% ts_xts()

#### OECD weekly tracker
temp <- tempfile()
download.file("https://github.com/NicolasWoloszko/OECD-Weekly-Tracker/raw/main/Data/weekly_tracker.xlsx",
              destfile = temp)

oecd <- read_xlsx(temp, sheet = "Sheet1") %>%
  #oecd <- read_xlsx("./real_data/weekly_tracker.xlsx", sheet = "Sheet1") %>%
  filter(region == "Austria") %>%
  #filter(region %in% c("Austria", "Germany", "Switzerland")) %>%
  mutate(date = as.Date(date),
         Tracker = `Tracker (yoy)` / 100) %>%
  filter(date >= "2020-01-01") %>%
  rename(time = date, value = Tracker) %>%
  dplyr::select(time, value) %>%
  ts_xts()

### OENB Weekly Tracker

temp <- tempfile()
download.file("https://www.oenb.at/dam/jcr:7c5ab44b-204d-4d45-a802-884d1019f7f5/data_on_the_weekly_GDP-indicator.csv",
              destfile = temp)

#### first weeks fehlt
wecon_oenb <- read_delim(temp, delim = ";", escape_double = FALSE, trim_ws = TRUE) %>%
  drop_na(Calenderweek) %>%
  rename(time = Calenderweek, value = `Real GDP compared to pre-crisis levels`) %>%
  dplyr::select(time, value)

wecon_oenb <- ts(wecon_oenb, start = c(2020,10), frequency = 52) %>% ts_xts()


library(lubridate)
wecon_oenb_test <- ts(wecon_oenb, 
   freq=365.25/7, 
   start=decimal_date(ymd("2020-03-06"))) %>% ts_xts()

wecon_oenb_test <- wecon_oenb_test %>% xts:::.drop.time()

### WIFO Weekly Tracker 
temp <- tempfile()
download.file("https://www.wifo.ac.at/wwadocs/konjunktur/W%C3%B6chentlicherWIFOWirtschaftsindex/WIFO-Konjunkturberichterstattung_W%C3%B6chentlicherWIFOWirtschaftsindex.xlsx",
              destfile = temp)

t0 <- as.numeric(as.Date("2007-01-01"))
t1 <- as.numeric(as.Date(Sys.Date()))
t <- round((t1 - t0) / 7) - 3 # weeks passed since index started

wwwi <- read_xlsx(temp, sheet = "WWWI",
                  #wwwi <- read_xlsx(path = "./real_data/wwwi_wifo.xlsx", sheet = "WWWI",
                  skip = 2, col_names = c("DATE", "VALUE", "cng_yavg", "cng_q"),
                  #col_types = c("date", "guess", "guess", "guess"), 
                  n_max = t) %>%
  mutate(DATE = as.character(DATE)) %>%
  dplyr::select(DATE, VALUE) %>%
  rename(time = DATE, value = VALUE) %>%
  ts_xts()
```


```{r,echo = FALSE}
google_w <- google_w[time(google_w) >= "2020-01-01"]  
wwwi <- wwwi[time(wwwi) >= "2020-01-01"]  
oecd <- oecd[time(oecd) >= "2020-01-01"]  

wecon_oenb <- wecon_oenb %>% xts:::.drop.time()
library(lubridate)
wwwi <- wwwi %>% ts_data.frame()
wwwi$time <- wwwi$time %m-% days(3)
wwwi <- wwwi %>% ts_xts()

oecd <- oecd %>% ts_data.frame()
oecd$time <- oecd$time %m-% days(2)
oecd <- oecd %>% ts_xts()

google_w <- google_w %>% ts_data.frame()
google_w$time <- google_w$time %m-% days(2)
google_w <- google_w %>% ts_xts()

wecon_oenb_test <- wecon_oenb_test %>% ts_data.frame()
wecon_oenb_test[1,1] <- as.Date("2020-03-06")
wecon_oenb_test <- wecon_oenb_test %>% ts_xts()
```

## Row {.tabset .tabset-fade}

### Comparison weekly indicators
```{r ce_background, echo = FALSE}

### {}

### Plot
library(dygraphs)
ts_dygraphs(ts_c(
  `Google DESI` = google_w * 5,
  `WIFO WWWI` = wwwi,
  `OECD Weekly Tracker` = oecd * 100,
  `OENB Weekly Indicator` = wecon_oenb_test
))  %>%
  dySeries("Google DESI", strokeWidth=2, color = "black") %>%
  dySeries("WIFO WWWI", strokeWidth = 2,  color = "red") %>%
  dySeries("OECD Weekly Tracker", strokeWidth = 2,  color = "green") %>%
  dySeries("OENB Weekly Indicator", strokeWidth = 2,  color = "steelblue") %>%
  dyAxis("x", drawGrid = FALSE) %>%
  dyRangeSelector()%>%
  #dyRangeSelector(dateWindow = c(as.Date("2020-01-01"), Sys.Date()))%>%
  dyOptions(useDataTimezone = TRUE)

```
### Monthly

```{r}
data_monthly <- ts_c(
  `Google DESI` = google_w * 5,
  `WIFO WWWI` = wwwi,
  `OECD Weekly Tracker` = oecd * 100,
  `OENB Weekly Indicator` = wecon_oenb_test
) %>%
  ts_frequency("month")
ts_dygraphs(ts_c(
  `Perceived Housing Situation` = data_monthly)) %>%
  dyRangeSelector()
```

### Info

###### Description

The weekly OeNB GDP indicator has been published since May 2020 and aims to measure the economic activity through the expenditure side of GDP. The OeNB uses a set of business cycle indicators that are collected on a daily or weekly basis and calculates a new activity indicator via a bridge equation model that depicts the development of real GDP compared to the corresponding week of the previous year on a weekly basis. The higher frequency indicators include truck mileage data, payment transaction data, labor market data, electricity consumption data, mobility indicators, and financial market data. See [weekly OeNB GDP indicator](https://www.oenb.at/Publikationen/corona/bip-indikator-der-oenb.html)

The WWWI is a weekly estimate of the real economic activity of the Austrian economy based on a time-series approach. It consists of 22 time series, including weekly, monthly, and quarterly indicators, covering eight GDP sub-components of the demand side of the quarterly National Accounts and nine of the production side. Weekly indicators include cashless transactions, freight transportation activity, passenger flight volumes, Google mobility data, unemployment, electricity consumption and pollutant emissions from industry, and international weekly indicators of economic activity. The WWWI uses temporal disaggregation models for historical decomposition and an ARMA-X nowcasting model for each weekly sub-indicator. In the end, the WWWI is obtained by summing up the growth contributions of the sub-indicators on the production side. See [Weekly Wifo Economic Index](https://www.wifo.ac.at/jart/prj3/wifo/main.jart?rel=en&content-id=1564766301706&reserve-mode=active)

The OECD Weekly Tracker of GDP growth applies a two-step machine learning model (“neural network”) to a panel of GT data to aggregate information from search behavior related to consumption, labor markets, housing, trade, industrial activity, and economic uncertainty. The tracker provides nowcasts of year-on-year GDP growth rates with a 5-day delay. See [OECD Weekly Tracker of economic activity](https://www.oecd.org/economy/weekly-tracker-of-gdp-growth/)

# Forecasting

Expanding OLS

VAR

ARIMA






